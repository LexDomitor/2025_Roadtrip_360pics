<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>360 Viewer</title>
<link href="https://fonts.googleapis.com/css2?family=Saira:wght@300;400;500&display=swap" rel="stylesheet">
<style>
body { margin:0; overflow:hidden; font-family: 'Saira', sans-serif; background:#000; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; }
#loadingOverlay {
    position:fixed; top:0; left:0; width:100vw; height:100vh;
    display:flex; justify-content:center; align-items:center; flex-direction:column;
    font-size:20px; color:#ccc; z-index:20; user-select:none;
    animation: pulse 1.5s infinite alternate;
}
@keyframes pulse { 0%{opacity:0.4;} 100%{opacity:1;} }
#instructionOverlay {
    position: fixed; top:0; left:0; width:100vw; height:100vh; background: rgba(0,0,0,0.65);
    color:#ccc; display:flex; justify-content:center; align-items:center; text-align:center;
    font-size:16px; padding:20px; cursor:pointer; z-index:10; display:none; user-select: none;
}
#footerBar {
    position: fixed; bottom:0; left:0; width:100%; height:18px;
    backdrop-filter: blur(8px); background: rgba(40,40,40,0.45); color:#ccc;
    font-size:12px; display:flex; align-items:center; justify-content:center; pointer-events:none; user-select:none;
}
</style>
</head>
<body>

<div id="loadingOverlay">Loading image... (0%)</div>
<div id="instructionOverlay">
    <div>
        <p>Controls:<br>- Drag with mouse/finger to rotate.<br>- Scroll/pinch to zoom.<br><br><b>Click to dismiss.</b></p>
    </div>
</div>
<div id="footerBar">Loading...</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/controls/OrbitControls.js"></script>
<script>
const loadingOverlay = document.getElementById('loadingOverlay');
const overlay = document.getElementById('instructionOverlay');
const footerBar = document.getElementById('footerBar');

// Scene setup
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableZoom = true;
controls.enablePan = false;
controls.rotateSpeed = 0.3;
camera.position.set(0,0,0.1);
controls.target.set(0,0,0);
controls.update();

let sphereMesh;

// Load the new image
const imagePath = 'halfmoonbay4k360.jpg';
const loader = new THREE.TextureLoader();

loader.load(
    imagePath,
    function(texture){ // onLoad
        const sphereGeo = new THREE.SphereGeometry(500, 60, 40);
        sphereGeo.scale(-1,1,1);
        sphereMesh = new THREE.Mesh(sphereGeo, new THREE.MeshBasicMaterial({map:texture}));
        scene.add(sphereMesh);
        loadingOverlay.style.display='none';
        overlay.style.display='flex';
        fetch('LICENSE').then(r=>r.text()).then(txt=>footerBar.textContent=txt).catch(()=>footerBar.textContent='Â© 2025. Do not distribute.');
    },
    function(xhr){ // onProgress
        if(xhr.lengthComputable){
            const percent = Math.round((xhr.loaded / xhr.total) * 100);
            loadingOverlay.textContent = `Loading image... (${percent}%)`;
            console.log(`Image load: ${percent}%`);
        } else {
            loadingOverlay.textContent = `Loading image...`;
        }
    },
    function(err){ // onError
        console.error('Error loading image', err);
        loadingOverlay.textContent='No images were found on server.';
        setTimeout(()=>loadingOverlay.style.display='none',3000);
    }
);

// Animation loop
function animate(){ requestAnimationFrame(animate); renderer.render(scene,camera); }
animate();

function onWindowResize(){ camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); }
window.addEventListener('resize', onWindowResize);

overlay.onclick = ()=>overlay.style.display='none';

// Disable right-click
document.addEventListener('contextmenu', e=>e.preventDefault());
</script>
</body>
</html>
