<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>360 Viewer</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: Arial, sans-serif;
        }

        /* Frosted thin bottom bar */
        #footerBar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 22px;
            backdrop-filter: blur(8px);
            background: rgba(40,40,40,0.35);
            color: #bfbfbf;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        /* Overlay instructions */
        #instructionOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.55);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 20px;
            padding: 20px;
            cursor: pointer;
            z-index: 10;
        }

        /* Arrows PC hover */
        .sideHotspot {
            position: fixed;
            top: 0;
            width: 15%;
            height: 100%;
            z-index: 5;
        }
        #leftHotspot { left: 0; }
        #rightHotspot { right: 0; }

        .arrowBtn {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 60px;
            height: 60px;
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.22);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 6;
        }
        #leftArrow { left: 30px; }
        #rightArrow { right: 30px; }

        .arrowBtn img {
            width: 32px;
            filter: invert(1);
        }
    </style>
</head>
<body>

<div id="instructionOverlay">
    <div>
        <p>Controls:<br>
        - Drag with mouse or finger to rotate.<br>
        - Scroll or pinch to zoom.<br>
        - Tap/Click left or right edge to cycle images.<br><br>
        <b>Click this message to dismiss it.</b></p>
    </div>
</div>

<div id="leftHotspot" class="sideHotspot"></div>
<div id="rightHotspot" class="sideHotspot"></div>

<div id="leftArrow" class="arrowBtn"><img src="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJ3aGl0ZSIgdmlld0JveD0iMCAwIDI0IDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xNS41OSAyMS4wN2EuOTkuOTkgMCAwIDEtLjcwMy0uMjkxbC03LjUtNy41YS45OTkuOTk5IDAgMCAxIDAtMS40MTlsNy41LTcuNWExIDEgMCAxIDEgMS40MTkgMS40MTlsLTYuNzkxIDYuNzkxIDYuNzkxIDYuNzkxQTEgMSAwIDAgMSAxNS41OSAyMS4wN1oiLz48L3N2Zz4=" /></div>
<div id="rightArrow" class="arrowBtn"><img src="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJ3aGl0ZSIgdmlld0JveD0iMCAwIDI0IDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xMC40MSAyMS4wN2EuOTkuOTkgMCAwIDAgLjcwMy0uMjkxbDcuNS03LjVhLjk5OS45OTkgMCAwIDAgMC0xLjQxOWwtNy41LTcuNWExIDEgMCAxIDAtMS40MTkgMS40MTlsNi43OTEgNi43OTEtNi43OTEgNi43OTFBMSAxIDAgMCAwIDEwLjQxIDIxLjA3WiIvPjwvc3ZnPg==" /></div>

<canvas id="viewer"></canvas>

<div id="footerBar">Images and Webpage (C) 2025 Alexander Puh, Alex Puh, Lex Machina, Lex Domitor. Do not distribute or modify my content.</div>

<script>
// --- Flexible image loading using directory scraping (works ONLY if server allows directory listing) ---
const canvas = document.getElementById('viewer');
const gl = canvas.getContext('webgl');
let images = [];
let currentIndex = 0;
let texture;

async function loadImages() {
    try {
        // Fetch directory index
        const res = await fetch('IMG/');
        const text = await res.text();

        // Parse filenames from directory listing
        const matches = [...text.matchAll(/href=["']([^"']+\.png)["']/gi)];
        const files = matches.map(m => m[1]);

        if (files.length === 0) {
            alert("No PNG images found in IMG folder.");
            return;
        }

        // Load each image
        for (const f of files) {
            const img = new Image();
            img.src = `IMG/${f}`;
            await new Promise(res => { img.onload = res; img.onerror = res; });
            if (img.width > 0) images.push(img);
        }

        initGL();
    } catch (e) {
        alert("Your server does NOT allow directory listing. Provide a JSON file or enable indexes.");
    }
}

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function initGL() {
    texture = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_2D, texture);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, images[currentIndex]);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);

    requestAnimationFrame(draw);
}

function draw() {
    gl.viewport(0, 0, canvas.width, canvas.height);
    gl.clearColor(0,0,0,1);
    gl.clear(gl.COLOR_BUFFER_BIT);
    requestAnimationFrame(draw);
}

function nextImage(dir) {
    if (images.length === 0) return;
    currentIndex = (currentIndex + dir + images.length) % images.length;
    gl.bindTexture(gl.TEXTURE_2D, texture);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, images[currentIndex]);
}

document.getElementById('leftHotspot').addEventListener('click', () => nextImage(-1));
document.getElementById('rightHotspot').addEventListener('click', () => nextImage(1));

document.getElementById('leftHotspot').addEventListener('mouseenter',()=>leftArrow.style.opacity=1);
document.getElementById('leftHotspot').addEventListener('mouseleave',()=>leftArrow.style.opacity=0);
document.getElementById('rightHotspot').addEventListener('mouseenter',()=>rightArrow.style.opacity=1);
document.getElementById('rightHotspot').addEventListener('mouseleave',()=>rightArrow.style.opacity=0);

const overlay = document.getElementById('instructionOverlay');
overlay.onclick = () => overlay.style.display = 'none';

loadImages();
</script>

</body>
</html>
