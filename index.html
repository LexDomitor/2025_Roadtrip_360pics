<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>360° Panorama - Half Moon Bay</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
<link href="https://fonts.googleapis.com/css2?family=Saira:wght@400;700&display=swap" rel="stylesheet">

<style>
body, #overlay, #overlay-content, #hotspot-panel, #video-link-panel, #license-bar,
#tooltip-preview, #qr-overlay, #youtube-overlay, #vr-button, #top-qr-button {
  user-select:none;
}
body { margin:0; font-family:'Saira',sans-serif; overflow:hidden; position:relative; }
#panorama { width:100vw; height:100vh; position:relative; }

/* ---------------- INTRO PANEL ---------------- */
#overlay {
  position:fixed; top:0; left:0; width:100vw; height:100vh;
  background:rgba(0,0,0,0.35);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  z-index:20; cursor:pointer;
}
#overlay-content {
  background:rgba(255,255,255,0.3);
  backdrop-filter:blur(10px);
  padding:40px;
  border-radius:25px;
  width:50vw;
  height:50vh;
  max-width:500px;
  max-height:500px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  text-align:center;
  color:#fff;
  font-size:1.4em;
  line-height:1.4em;
}
#overlay-content p { margin:10px 0; }

#overlay-content a {
  color:#fff;
  text-decoration:underline;
  cursor:pointer;
}

#dismiss-message {
  margin-top:20px;
  color:#ccc;
  font-size:0.9em;
}

/* ---------------- PREVIEW TOOLTIP ---------------- */
#tooltip-preview {
  display:none;
  position:absolute;
  width:260px;
  padding:10px;
  background:rgba(0,0,0,0.85);
  border-radius:10px;
  color:#fff;
  z-index:50;
  pointer-events:none;
  text-align:center;
}
#tooltip-preview img {
  width:240px;
  border-radius:8px;
}
#tooltip-preview a {
  color:#fff;
  text-decoration:underline;
  font-size:0.8em;
}

/* ---------------- INFO PANELS ---------------- */
#hotspot-panel {
  position:fixed; top:20px; left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.2);
  backdrop-filter:blur(10px);
  padding:15px 20px;
  border-radius:15px;
  color:#fff;
  font-size:1em;
  text-align:center;
  max-width:80%;
  display:none;
  z-index:15;
}

#video-link-panel {
  position:fixed;
  top:190px;  /* LOWERED SLIGHTLY */
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.2);
  backdrop-filter:blur(10px);
  padding:12px 15px;
  border-radius:12px;
  color:#fff;
  font-size:1em;
  cursor:pointer;
  display:none;
  z-index:15;
}

/* ---------------- QR PANEL ---------------- */
#qr-overlay {
  display:none; opacity:0;
  position:fixed; top:0; left:0; width:100vw; height:100vh;
  background:rgba(0,0,0,0.55);
  z-index:30;
  display:flex; align-items:center; justify-content:center;
  transition:opacity .4s;
}
#qr-content {
  background:rgba(255,255,255,0.3);
  backdrop-filter:blur(10px);
  border-radius:20px;
  padding:20px;
  width:200px;   /* HALF SIZE */
  height:auto;
  display:flex;
  flex-direction:column;
  align-items:center;
}
#qr-content img {
  width:100%;
  border-radius:10px;
}
#qr-content p {
  margin-top:12px;
  color:#ccc;
  font-size:0.9em;
  text-align:center;
}

/* ---------------- YOUTUBE MODAL ---------------- */
#youtube-overlay {
  display:none; opacity:0;
  position:fixed; top:0; left:0; width:100vw; height:100vh;
  background:rgba(0,0,0,0.55);
  z-index:30;
  display:flex; align-items:center; justify-content:center;
  transition:opacity .4s;
}

#youtube-content {
  background:rgba(255,255,255,0.25);
  backdrop-filter:blur(10px);
  border-radius:20px;
  width:800px; height:450px;
  padding:20px;
  display:flex; flex-direction:column;
}
#youtube-content iframe {
  width:100%; height:100%; border:none; border-radius:12px;
}
#youtube-content p {
  margin-top:10px;
  color:#ddd;
  font-size:0.9em;
  text-align:center;
}

/* ---------------- TOP BUTTONS ---------------- */
#top-qr-button, #vr-button {
  position:fixed; top:10px;
  right:10px;
  background:rgba(0,0,0,0.2);
  backdrop-filter:blur(10px);
  color:#fff;
  padding:8px 15px;
  border-radius:12px;
  cursor:pointer;
  z-index:25;
}
#vr-button { top:55px; display:none; }

/* LICENSE */
#license-bar {
  position:fixed;
  bottom:15px; left:50%; transform:translateX(-50%);
  background:rgba(0,0,0,0.2);
  backdrop-filter:blur(10px);
  padding:10px 20px;
  border-radius:10px;
  max-width:90%;
  text-align:center;
  color:#fff;
  font-size:14px;
}
</style>
</head>
<body>

<div id="panorama"></div>

<!-- Intro overlay -->
<div id="overlay">
  <div id="overlay-content">
    <p>Hi, I'm Lex, a nobody magician who enjoys travel, tech and research. These images were shot in Northern California at 120MP.</p>
    <p>If you would like to see my other work click <a id="preview-link">here</a>.</p>
  </div>
  <p id="dismiss-message">Click Anywhere to Dismiss</p>
</div>

<!-- Hover tooltip preview -->
<div id="tooltip-preview">
  <img src="https://i.imgur.com/eKxOrcZ.jpeg">
  <br>
  <a href="https://linktr.ee/lexofdystopia" target="_blank">https://linktr.ee/lexofdystopia</a>
</div>

<!-- Info panels -->
<div id="hotspot-panel">
  Manhattan Beach at Half Moon Bay, California.<br>
  The Ritz-Carlton sits on the distant cliffs.<br>
  The coast is lined with miles of golf courses.
</div>

<div id="video-link-panel">Click Here to Watch a 360 Video of this Location</div>

<div id="license-bar">Loading license...</div>

<!-- Top buttons -->
<div id="top-qr-button">QR</div>
<div id="vr-button">VR</div>

<!-- YouTube modal -->
<div id="youtube-overlay">
  <div id="youtube-content">
    <iframe id="youtube-frame"></iframe>
    <p>Click Anywhere to Dismiss</p>
  </div>
</div>

<!-- QR modal -->
<div id="qr-overlay">
  <div id="qr-content">
    <img src="VRQR.png">
    <p>Click Anywhere to Dismiss</p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
<script>
/* ---------------- Panorama ---------------- */
const viewer = pannellum.viewer('panorama',{
  type:'equirectangular',
  panorama:"https://i.imgur.com/FYdmUI3.jpeg",
  hfov:100,
  autoLoad:true,
  showFullscreenCtrl:true
});

/* ---------------- Intro dismiss ---------------- */
const overlay = document.getElementById('overlay');
overlay.addEventListener('click',()=>{
  overlay.style.display='none';
  document.getElementById('hotspot-panel').style.display='block';
  document.getElementById('video-link-panel').style.display='block';
});

/* ---------------- Load LICENSE ---------------- */
fetch('LICENSE')
  .then(r=>r.text())
  .then(t=>document.getElementById('license-bar').textContent=t)
  .catch(()=>document.getElementById('license-bar').textContent='LICENSE not found.');

/* ---------------- Hover Preview ---------------- */
const previewLink = document.getElementById('preview-link');
const tooltip = document.getElementById('tooltip-preview');

previewLink.addEventListener('mouseenter',e=>{
  const r = e.target.getBoundingClientRect();
  tooltip.style.left = (r.left + r.width/2 - tooltip.offsetWidth/2) + "px";
  tooltip.style.top = (r.top - tooltip.offsetHeight - 10) + "px";
  tooltip.style.display="block";
});

previewLink.addEventListener('mouseleave',()=> tooltip.style.display="none");

previewLink.addEventListener('click', e=>{
  e.stopPropagation();                // DO NOT close intro panel  
  window.open("https://linktr.ee/lexofdystopia","_blank");
});

/* ---------------- 360 Video modal ---------------- */
const videoPanel = document.getElementById('video-link-panel');
const ytOverlay = document.getElementById('youtube-overlay');
const ytFrame = document.getElementById('youtube-frame');

videoPanel.addEventListener('click', e=>{
  e.stopPropagation();
  ytOverlay.style.display='flex';
  requestAnimationFrame(()=>{
    ytOverlay.style.opacity=1;
    setTimeout(()=> {
      ytFrame.src="https://www.youtube.com/embed/sfYM1-_WbWk";
    },200);  // FIXES Error 153
  });
});

ytOverlay.addEventListener('click',()=>{
  ytOverlay.style.opacity=0;
  setTimeout(()=>{
    ytOverlay.style.display='none';
    ytFrame.src="";
  },300);
});

/* ---------------- QR modal ---------------- */
const qrBtn = document.getElementById('top-qr-button');
const qrOverlay = document.getElementById('qr-overlay');

qrBtn.addEventListener('click', e=>{
  e.stopPropagation();
  qrOverlay.style.display='flex';
  requestAnimationFrame(()=> qrOverlay.style.opacity=1);
});

qrOverlay.addEventListener('click',()=>{
  qrOverlay.style.opacity=0;
  setTimeout(()=> qrOverlay.style.display='none',300);
});

/* ---------------- VR Detection ---------------- */
async function detectVR(){
  if(navigator.xr){
    try{
      return await navigator.xr.isSessionSupported("immersive-vr");
    }catch(_){return false;}
  }
  return navigator.userAgent.includes("Quest");
}

detectVR().then(supported=>{
  if(supported) document.getElementById('vr-button').style.display='block';
});

/* VR button → open VR page */
document.getElementById('vr-button').addEventListener('click',e=>{
  e.stopPropagation();
  window.open("vr.html","_blank");
});
</script>
</body>
</html>
